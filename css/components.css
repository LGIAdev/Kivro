/* =====================================================================
   components.css ‚Äî Kivro (r√©√©crit proprement)
   Sections:
   1) Chat / Messages
   2) Pastilles / Status
   3) Modales / R√©glages
   4) Branding / Sidebar
   5) Topbar (s√©lecteur de mod√®les)
   6) Barre d‚Äôinvite (composer) + ic√¥nes
   ===================================================================== */

   /* === KaTeX styles (offline, local) === */
   @import url("../assets/vendor/katex/katex.min.css");

/* ===================== 1) Chat / Messages ========================= */
.chat-log{
  width:80%;               /* largeur stable proportionnelle √† l‚Äô√©cran */
  max-width:920px;        /* limite sur grands √©crans */
  margin:20px auto 8px auto;
  padding:0 16px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.msg {
  display: flex;
  flex-direction: column; /* üëâ r√¥le au-dessus, bulle en dessous */
  align-items: flex-start; 
  gap: 4px; /* petit espace vertical */
}
.msg .role {
  font-weight: 600;
  opacity: .8;
  min-width: auto;   /* üëâ plus besoin de largeur fixe */
  align-self: flex-start; /* toujours cal√© √† gauche */
}
.msg .bubble{
  background:var(--panel);
  border:1px solid var(--border);
  padding:12px 14px;
  border-radius:12px;

  /* Gestion du texte et largeur */
  white-space:pre-wrap;
  word-wrap:break-word;
  overflow-wrap:break-word;
  max-width:100%;
  box-sizing:border-box;
}
.msg.user .bubble{ background:transparent; border-style:dashed; }

/* ===================== 2) Pastilles / Status ====================== */
.status-pill{
  display:inline-flex;
  align-items:center;
  gap:8px;
  border:1px solid var(--border);
  padding:6px 10px;
  border-radius:16px;
  font-size:.9rem;
  opacity:.9;
}
.status-ok{ color:var(--accent); }
.status-bad{ color:#ef4444; }

/* ===================== 3) Modales / R√©glages ====================== */
.modal-overlay{
  display:none;
  position:fixed; inset:0;
  background:rgba(0,0,0,.5);
  z-index:999;
  align-items:center; justify-content:center;
}
.modal-card{
  background:#0c1119;
  padding:20px; border-radius:12px; min-width:300px;
  display:flex; align-items:center; gap:10px; color:var(--text);
  border:1px solid var(--border);
}

.settings-card{
  background:var(--panel); color:var(--text);
  border:1px solid var(--border);
  border-radius:14px;
  min-width:520px; max-width:min(92vw, 720px);
  box-shadow:0 12px 40px rgba(0,0,0,.25);
}
.settings-head{ padding:14px 16px; border-bottom:1px solid var(--border); }
.settings-tabs{ display:flex; gap:8px; }
.settings-tab{
  background:var(--chip);
  border:1px solid var(--chip-border);
  border-radius:10px;
  padding:8px 10px;
  cursor:pointer;
}
.settings-tab.active{ background:var(--hover); }
.settings-body{ padding:16px; }
.settings-section{ display:flex; flex-direction:column; gap:16px; }
.settings-title{ font-weight:600; color:var(--muted); font-size:.9rem; }
.settings-item{ display:grid; grid-template-columns:140px 1fr; gap:12px; align-items:center; }
.settings-controls{ display:flex; gap:16px; align-items:center; }
.radio input{ margin-right:6px; }

/* ===================== 4) Branding / Sidebar ====================== */
.brand-left{ display:flex; align-items:center; gap:6px; line-height:1; }
.brand-left .brand-mark{ display:block; }
.brand-left .brand-name{ font-weight:700; letter-spacing:.2px; }

/* Contraste du logo si n√©cessaire */
:root { --brand-contrast: #ffffff; }
[data-theme="light"] { --brand-contrast:#ffffff; }
[data-theme="dark"]  { --brand-contrast:#0b1220; }
.brand-left .brand-mark text{
  paint-order: stroke fill; stroke: rgba(0,0,0,.25); stroke-width:.5px;
}

/* Sidebar */
.sidebar{ overflow-x:hidden; }
.sidebar .side-search{ margin:2px 2px; }
.sidebar .side-search input{
  display:block; width:100%; max-width:100%; box-sizing:border-box;
  padding:10px 14px; border-radius:12px;
}

/* ===================== 6) Barre d‚Äôinvite (composer) =============== */
.composer-card{
  background:#0e1624;
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
  color:var(--text);
  box-shadow:0 0 0 1px rgba(255,255,255,.02) inset;

  /* largeur harmonieuse + centrage */
  width:80%;
  max-width:900px;
  margin:0 auto;
}
.composer-header{
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom:8px;
}
.actions{
  margin-left:auto;
  display:flex;
  align-items:center;
  gap:8px;
}

/* Zone de saisie (textarea) ‚Äî autosize + alignement */
.composer-input{
  width:100%;
  background:#0c131f;
  color:var(--text);
  border:1px solid var(--border);
  border-radius:12px;
  padding:14px 16px;
  outline:none;

  /* ‚úÖ corrige le d√©bordement √† droite */
  box-sizing:border-box;
  display:block;

  /* Autosize (g√©r√© aussi par js/ui/autogrow.js) */
  resize:none;
  overflow:hidden;
  min-height:48px;
  max-height:240px;
  line-height:1.4;
  font-size:16px;
}

.toolbar{ display:flex; align-items:center; gap:8px; margin-top:8px; }
.pill{
  background:#0c131f;
  border:1px solid var(--border);
  color:var(--subtle);
  padding:6px 10px;
  border-radius:999px;
  font-size:12px;
}

/* Boutons d‚Äôic√¥ne : micro, casque, envoyer */
.icon-btn{
  display:grid;
  place-items:center;
  width:36px; height:36px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#0c131f;
  color:var(--text);
  cursor:pointer;
}

/* ‚úÖ Ic√¥nes visibles (taille/trait/couleur corrects) */
.icon-btn svg{
  width:18px; height:18px; display:block;
  stroke:currentColor; fill:none; stroke-width:1.8;
}

/* Bouton envoyer en accent circulaire */
.icon-btn#send-btn{
  background:var(--accent);
  color:#fff;
  border-color:transparent;
  border-radius:999px;
}
.icon-btn#send-btn:hover{ filter:brightness(1.08); }

/* Mode clair ‚Äî pipeline "barre d'invite" avec .composer-card/.composer-input */
:root[data-theme="light"] .composer-card{
  background:#0c1119;           /* fond sombre coh√©rent */
  border-color:#26344a;
}

:root[data-theme="light"] .composer-input{
  background:#0e131c;           /* champ sombre */
  color:#fff;                   /* texte lisible */
  border-color:#26344a;
  caret-color:#fff;             /* curseur visible */
}

:root[data-theme="light"] .composer-input::placeholder{
  color:rgba(255,255,255,.75);  /* placeholder lisible */
}

:root[data-theme="dark"] #model-select{ color-scheme: dark; }

/* Fallback si non support√© */
@supports not (color-scheme: dark){
  :root[data-theme="dark"] #model-select{
    background:#0f172a; color:#e5e7eb;
    border:1px solid #334155; border-radius:8px;
  }
  :root[data-theme="dark"] #model-select:focus{
    outline:none; box-shadow:0 0 0 2px rgba(59,130,246,.35); border-color:#60a5fa;
  }
  :root[data-theme="dark"] #model-select option,
  :root[data-theme="dark"] #model-select optgroup{
    background:#0f172a; color:#e5e7eb;
  }
}

/* Contenir KaTeX dans la bulle de chat sans barres parasites */
.msg .bubble .katex-display{
  overflow-x:hidden;     /* emp√™che la barre horizontale */
  overflow-y:hidden;   /* emp√™che la barre verticale */
  max-width:100%;
}
.msg .bubble .katex-display > .katex{ max-width:100%; }  /* pas de white-space forc√© */
.msg .bubble .katex{ max-width:100%; }
.msg .bubble .katex img{ max-width:100%; height:auto; }

/* ===================== 7) Tableaux (chat) ====================== */

/* La bulle peut scroller horizontalement si le tableau est plus large */
.msg .bubble{
  overflow-x:auto;
}

/* Table principale (ne d√©passe pas la bulle, peut d√©clencher un scroll) */
.msg .bubble table{
  width:max-content;  /* tableau √©largi selon son contenu */
  table-layout:auto;            /* colonnes souples (meilleur wrap du texte) */
  min-width:100%;  /* au moins la largeur de la bulle */

  /* Styles existants conserv√©s */
  border-collapse:separate;     /* coins arrondis fiables */
  border-spacing:0;
  margin:14px 0;
  font-size:.95rem;
  background:var(--panel);
  border:2px solid var(--border);
  border-radius:8px;
  box-shadow:0 2px 12px rgba(0,0,0,.06);
}

/* En-t√™te */
.msg .bubble thead th{
  padding:10px 14px;
  font-weight:700;
  text-align:center;
  background:var(--hover);
  color:var(--text);
  border-right:1px solid var(--border);
  border-bottom:2px solid var(--border);
}
.msg .bubble thead th:last-child{ border-right:none; }

/* Corps */
.msg .bubble tbody td{
  padding:10px 14px;
  text-align:center;
  background:transparent;
  color:var(--text);
  border-right:1px solid var(--border);
  border-bottom:1px solid var(--border);
}
.msg .bubble tbody td:last-child{ border-right:none; }
.msg .bubble tbody tr:last-child td{ border-bottom:none; }

/* Premi√®re colonne = m√™me fond que l‚Äôen-t√™te */
.msg .bubble tbody td:first-child{
  background:var(--hover);
  font-weight:600;
}

/* Survol (hors 1re colonne) */
.msg .bubble tbody tr:hover td{
  background:var(--chip);
}
.msg .bubble tbody tr:hover td:first-child{
  background:var(--hover);
}

/* L√©gende optionnelle */
.msg .bubble table caption{
  caption-side:top;
  font-weight:600;
  color:var(--muted);
  padding-bottom:6px;
  text-align:left;
}

/* ‚úÖ Texte multi-lignes dans toutes les cellules (sans casser KaTeX) */
.msg .bubble table th,
.msg .bubble table td{
  white-space:normal;        /* autorise plusieurs lignes */
  word-break:break-word;     /* casse mots tr√®s longs */
  overflow-wrap:anywhere;    /* casse m√™me sans espaces */
  hyphens:auto;
}
/* Conserver le nowrap uniquement pour les formules KaTeX (rendu stable) */
.msg .bubble .katex .base,
.msg .bubble .katex-display > .katex{
  white-space:nowrap !important;
}

/* Barre de d√©filement discr√®te sur la bulle (porteuse du scroll) */
.msg .bubble{
  scrollbar-width: thin;                                  /* Firefox */
  scrollbar-color: rgba(255,255,255,.28) transparent;     /* Firefox */
}
.msg .bubble::-webkit-scrollbar{ height:6px; }            /* Chrome/Edge/Safari */
.msg .bubble::-webkit-scrollbar-track{ background:transparent; }
.msg .bubble::-webkit-scrollbar-thumb{
  background: rgba(255,255,255,.28);
  border-radius: 4px;
}
.msg .bubble:hover::-webkit-scrollbar-thumb{
  background: rgba(255,255,255,.45);
}
